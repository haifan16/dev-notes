Redis 会把每一个 master 节点映射到 0~16383 共 16384 个插槽上

数据 key 不是与节点绑定，而是与插槽绑定。Redis 会根据 key 的有效部分计算插槽值，分两种情况：

- key 中包含 "{}"，且 "{}" 中至少包含 1 个字符，"{}" 中的部分是有效部分
- key 中不包含 "{}"，整个 key 都是有效部分

例如：key 是 num，那么就根据 num 计算，如果是 {hello}num，则根据 hello 计算。计算方式是利用 CRC16 算法得到一个 hash 值，然后对 16384 取余，得到的结果就是 slot 值。

## Redis 是如何判断某个 key 应该在哪个实例上的？

1. 在创建集群时，将 16384 个插槽分配到各个实例（节点）上
2. 当存储/获取一个 key 时，根据 key 的有效部分计算哈希值
    -> 对 16384 取余得到插槽值 
    -> 寻找插槽所在实例（节点）

## 如何将同一类数据固定保存在同一个 Redis 实例（为了避免请求重定向带来的性能损耗）？

这一类数据使用相同的有效部分，例如 key 都以 {typeId} 为前缀